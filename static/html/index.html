<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>åšå®¢é¡µé¢</title>
    <style>
        html, body { min-height: 100vh; }
        body {
            margin: 0;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            /* ç›´æ¥ä½¿ç”¨èƒŒæ™¯å›¾ï¼Œç¡®ä¿å¯è§ */
            background: #0c0f14 url('/static/img/%E8%83%8C%E6%99%AF.jpg') center center / cover no-repeat fixed;
        }
        /* å…¨å±ç”»å¸ƒç”¨äºèŠ±ç“£ç‰¹æ•ˆ */
        #bg-canvas {
            position: fixed;
            left: 0; top: 0; right: 0; bottom: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        .navbar {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 20px;
            background: #222;
            color: #fff;
            padding: 0 32px;
            height: 60px;
        }
        .navbar-title {
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 2px;
        }
        .navbar-actions {
            display: flex;
            gap: 16px;
            margin-left: auto;
        }
        .navbar-actions a {
            color: #fff;
            text-decoration: none;
            padding: 8px 18px;
            border-radius: 4px;
            background: #007bff;
            transition: background 0.2s;
        }
        .navbar-actions a:hover {
            background: #0056b3;
        }
        .user-welcome {
            color: #fff;
            padding: 8px 18px;
            background: #28a745;
            border-radius: 4px;
            margin-right: 10px;
        }
        .navbar-actions a.user-welcome {
            background: #28a745 !important;
            color: #fff !important;
        }
        .logout-btn {
            color: #fff !important;
            background: #dc3545 !important;
        }
        .logout-btn:hover {
            background: #c82333 !important;
        }
        .main-content {
            margin: 40px auto;
            max-width: 1000px;
            /* æ¯›ç»ç’ƒå®¹å™¨ */
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.18);
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.35);
            backdrop-filter: blur(16px) saturate(120%);
            -webkit-backdrop-filter: blur(16px) saturate(120%);
            padding: 32px;
            min-height: 300px;
            position: relative;
            z-index: 1;
            color: #111;
        }
        .blog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255,255,255,0.12);
            padding-bottom: 20px;
        }
        .blog-header h2 {
            margin: 0;
            color: #111;
        }
        .btn-new-blog {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        .btn-new-blog:hover {
            background: #218838;
        }
        .blog-list {
            min-height: 200px;
        }
        .blog-item {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.16);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: box-shadow 0.2s, background 0.2s, transform 0.15s ease;
            cursor: pointer;
        }
        .blog-item:hover {
            background: rgba(255,255,255,0.10);
            box-shadow: 0 10px 28px rgba(0,0,0,0.25);
            transform: translateY(-1px);
        }
        .blog-item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
            background: #f0f0f0;
            flex: 0 0 28px;
        }
        .avatar-fallback {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #555;
            border: 1px solid #e1e1e1;
        }
        .blog-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #111;
            margin-bottom: 10px;
        }
        .blog-summary {
            color: #111;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        .blog-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #111;
        }
        .blog-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 12px;
            color: #111;
        }
        .metrics {
            display: flex;
            gap: 14px;
            align-items: center;
            color: #111;
        }
        .metric {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .blog-author {
            font-weight: bold;
            color: #111;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 10px;
        }
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .pagination button:hover {
            background: #f8f9fa;
        }
        .pagination button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .modal-header h3 {
            margin: 0;
        }
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        .close:hover {
            color: #333;
        }
        .modal-body {
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
            font-family: inherit;
        }
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }
        .form-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .form-actions button[type="submit"] {
            background: #007bff;
            color: white;
        }
        .form-actions button[type="button"] {
            background: #6c757d;
            color: white;
        }
        /* ç•™è¨€å¼¹çª—é¢å¤–æ ·å¼å¯å¤ç”¨é€šç”¨modal */
        /* ä»£ç å—æ ·å¼ */
        pre {
            background: #f6f8fa;
            padding: 12px;
            border-radius: 6px;
            overflow: auto;
        }
        pre code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
        }
        /* é¡¶éƒ¨ä¸‹æ‹‰èœå•ï¼ˆå¯¼èˆªæ å·¦ä¾§ï¼Œå’Œç™»å½•æ³¨å†ŒåŒä¸€è¡Œï¼‰ */
        .header-menus { display:flex; gap:10px; margin-left: 12px; }
        .menu-dropdown { position: relative; }
        .menu-dropdown-btn { padding: 8px 14px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 999px; cursor: pointer; }
        .menu-dropdown-btn:hover { background: #eef2f7; }
        .menu-dropdown-menu {
            position: absolute; top: calc(100% + 6px); right: 0; min-width: 170px; background: #fff; border: 1px solid #e9ecef; border-radius: 10px; box-shadow: 0 10px 28px rgba(0,0,0,0.12); padding: 10px; display: none; z-index: 10;
        }
        .menu-dropdown.open .menu-dropdown-menu { display: block; }
        .menu-dropdown-menu a {
            display:block; padding:10px 12px; border-radius:8px; color:#333; text-decoration:none;
        }
        .menu-dropdown-menu a:hover { background:#f1f5ff; }
        .menu-dropdown-menu a.disabled { color:#aaa; pointer-events:none; }
        /* ç®€å•æš—è‰²åˆ‡æ¢ */
        body.dark { background: #0f1113; color: #e5e7eb; }
        body.dark .navbar { background: #0b0d10; }
        body.dark .main-content {
            background: rgba(255,255,255,0.06);
            border-color: rgba(255,255,255,0.18);
            color: #f5f7fb;
        }
        body.dark .blog-header { border-bottom-color: rgba(255,255,255,0.12); }
        body.dark .blog-header h2 { color: #f5f7fb; }
        body.dark .blog-item {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.16);
        }
        body.dark .blog-title { color: #ffffff; }
        body.dark .blog-summary { color: #e6ebf5; }
        body.dark .blog-meta { color: #d6deea; }
        body.dark .blog-footer { color: #d6deea; }
        body.dark .metrics { color: #d6deea; }
        body.dark .blog-author { color: #ffffff; }
    </style>
  <!-- ä»£ç é«˜äº®ä¸Markdownè§£æ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.6/purify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <nav class="navbar">
        <div class="navbar-title">åšå®¢é¡µé¢</div>
        <div class="header-menus">


            <div class="menu-dropdown">
                <button class="menu-dropdown-btn">åŠŸèƒ½</button>
                <div class="menu-dropdown-menu">
                    <a href="#" id="menu-refresh">åˆ·æ–°åˆ—è¡¨</a>
                    <a href="#" id="menu-top">å›åˆ°é¡¶éƒ¨</a>
                    <a href="#" id="menu-toggle-theme">æµ…/æ·±è‰²åˆ‡æ¢</a>
                </div>
            </div>
            <div class="menu-dropdown">
                <button class="menu-dropdown-btn">åˆ†ç±»</button>
                <div class="menu-dropdown-menu">
                    <a href="#" >åšå®¢</a>
                    <a href="/software">è½¯ä»¶</a>
                    <a href="/f" >åŠŸèƒ½</a>
                </div>
            </div>
            <div class="menu-dropdown">
                <button class="menu-dropdown-btn">æ›´å¤š</button>
                <div class="menu-dropdown-menu">    
                    <a href="#" id="menu-contact">è”ç³»æˆ‘</a>
                    <a href="#" id="menu-about">å…³äºæˆ‘</a>
                    <a href="#" id="menu-chat">ç•™è¨€</a>
                </div>
            </div>
        </div>
        <div class="navbar-actions" id="navbar-actions">
            <!-- åŠ¨æ€å†…å®¹å°†é€šè¿‡JavaScriptæ’å…¥ -->
        </div>
    </nav>
    <div class="main-content">
        <!-- åšå®¢æ“ä½œåŒºåŸŸ -->
        <div class="blog-header">
            <h2>åšå®¢æ–‡ç« </h2>
            <div style="display:flex; gap:8px; align-items:center; margin-left:auto;">
                <div id="blog-filter" style="display:flex; gap:6px;">
                    <button id="filter-published" type="button" style="padding:6px 10px;">å·²å‘å¸ƒ</button>
                    <button id="filter-drafts" type="button" style="padding:6px 10px;">è‰ç¨¿</button>
                </div>
                <button id="new-blog-btn" class="btn-new-blog" style="display: none;">æ–°å»ºåšå®¢</button>
            </div>
        </div>
        
        <!-- åšå®¢åˆ—è¡¨ -->
        <div id="blog-list" class="blog-list">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
        
        <!-- åˆ†é¡µ -->
        <div id="pagination" class="pagination" style="display: none;"></div>
    </div>

    <!-- é¡µè„šï¼šç½‘ç«™è®¿é—®è®¡æ•° -->
    <div id="site-visit-footer" style="
        position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.55); color: #fff; padding: 6px 12px; border-radius: 16px;
        font-size: 14px; z-index: 1001;">
        ç½‘ç«™å·²æ¥å¾…ï¼š<span id="site-visit-count">-</span> äºº
    </div>

    <!-- æ–°å»ºåšå®¢æ¨¡æ€æ¡† -->
    <div id="blog-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">æ–°å»ºåšå®¢</h3>
                <span class="close" onclick="closeBlogModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="blog-form">
                    <div class="form-group">
                        <label for="blog-title">æ ‡é¢˜</label>
                        <input type="text" id="blog-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="blog-summary">æ‘˜è¦ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="blog-summary" name="summary" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="blog-content">å†…å®¹</label>
                        <textarea id="blog-content" name="content" rows="10" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="blog-publish" name="status" value="1" checked>
                            ç«‹å³å‘å¸ƒ
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeBlogModal()">å–æ¶ˆ</button>
                        <button type="button" onclick="saveDraft()" style="background:#6c757d;color:#fff;">å­˜ä¸ºè‰ç¨¿</button>
                        <button type="submit">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- åšå®¢è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="blog-detail-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detail-title">åšå®¢è¯¦æƒ…</h3>
                <span class="close" onclick="closeBlogDetailModal()">&times;</span>
            </div>
            <div class="modal-body">
                <h4 id="detail-blog-title"></h4>
                <div id="detail-meta" class="blog-meta" style="margin: 8px 0; color: #666; font-size: 12px;"></div>
                <p id="detail-summary" style="background:#f8f9fa; padding:10px; border-radius:6px;"></p>
                <div id="detail-content" style="margin-top:12px; white-space: pre-wrap;"></div>
                <div id="detail-actions" style="margin-top: 16px; text-align: right;"></div>
            </div>
        </div>
    </div>

    <!-- é€šç”¨ä¿¡æ¯æ¨¡æ€æ¡†ï¼ˆå…³äºæˆ‘/è”ç³»æˆ‘ï¼‰ -->
    <div id="info-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="info-title">ä¿¡æ¯</h3>
                <span class="close" onclick="closeInfoModal()">&times;</span>
            </div>
            <div class="modal-body" id="info-body"></div>
        </div>
    </div>

    <!-- ç•™è¨€æ¨¡æ€æ¡† -->
    <div id="message-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç•™è¨€</h3>
                <span class="close" onclick="closeMessageModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="message-form">
                    <div class="form-group">
                        <label for="message-text">è¯·è¾“å…¥ç•™è¨€å†…å®¹</label>
                        <textarea id="message-text" name="message" rows="5" required placeholder="è¯´ç‚¹ä»€ä¹ˆå§..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeMessageModal()">å–æ¶ˆ</button>
                        <button type="submit">æäº¤</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€å¹¶åŠ¨æ€æ›´æ–°å¯¼èˆªæ 
        function updateNavbar() {
            const navbarActions = document.getElementById('navbar-actions');
            
            
            // è°ƒç”¨åç«¯APIæ£€æŸ¥ç™»å½•çŠ¶æ€
            fetch('/user/api/current', {
                method: 'GET',
                credentials: 'include', // åŒ…å«cookiesä»¥å‘é€session
                cache: 'no-cache' // ç¦ç”¨ç¼“å­˜
            })
            .then(response => {
                return response.json();
            })
            .then(data => {
                
                if (data.code === 200) {
                    currentUser = data.data;
                    // ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯å’Œé€€å‡ºæŒ‰é’®
                    navbarActions.innerHTML = `
                        <a href="/user/settings" class="user-welcome">æ¬¢è¿ï¼Œ${data.data.username}</a>
                        <a href="#" class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</a>
                    `;
                    // æ˜¾ç¤ºæ–°å»ºåšå®¢æŒ‰é’®
                    document.getElementById('new-blog-btn').style.display = 'block';
                } else {
                    currentUser = null;
                    // ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•å’Œæ³¨å†ŒæŒ‰é’®
                    navbarActions.innerHTML = `
                        <a href="/user/login">ç™»å½•</a>
                        <a href="/user/register">æ³¨å†Œ</a>
                    `;
                    // éšè—æ–°å»ºåšå®¢æŒ‰é’®
                    document.getElementById('new-blog-btn').style.display = 'none';
                }
            })
            .catch(error => {

                // å‡ºé”™æ—¶æ˜¾ç¤ºç™»å½•å’Œæ³¨å†ŒæŒ‰é’®
                navbarActions.innerHTML = `
                    <a href="/user/login">ç™»å½•</a>
                    <a href="/user/register">æ³¨å†Œ</a>
                `;
            });
        }

        // é€€å‡ºç™»å½•å‡½æ•°
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                fetch('/user/api/logout', {
                    method: 'POST',
                    credentials: 'include' // åŒ…å«cookiesä»¥å‘é€session
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('å·²é€€å‡ºç™»å½•');
                        updateNavbar();
                    } else {
                        alert('é€€å‡ºç™»å½•å¤±è´¥');
                    }
                })
                .catch(error => {

                    alert('é€€å‡ºç™»å½•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
                });
            }
        }

        // å…¨å±€å˜é‡
        let currentUser = null;
        let currentPage = 1;
        let isSavingDraft = false;
        // 1=å·²å‘å¸ƒ, 0=è‰ç¨¿
        let currentStatusFilter = 1;

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°å¯¼èˆªæ å’ŒåŠ è½½åšå®¢
        document.addEventListener('DOMContentLoaded', function() {
            updateNavbar();
            setFilterActiveButton();
            loadBlogs();
            initHeaderMenus();
            initPetalEffects();
            // é¡µé¢åŠ è½½åå¢åŠ è®¿é—®è®¡æ•°
            incrementVisitCounter();
            
            // ç»‘å®šæ–°å»ºåšå®¢æŒ‰é’®äº‹ä»¶
            document.getElementById('new-blog-btn').addEventListener('click', openBlogModal);
            
            // ç»‘å®šåšå®¢è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('blog-form').addEventListener('submit', handleBlogSubmit);
            // ç»‘å®šç­›é€‰æŒ‰é’®
            const filterPublishedBtn = document.getElementById('filter-published');
            const filterDraftsBtn = document.getElementById('filter-drafts');
            if (filterPublishedBtn && filterDraftsBtn) {
                filterPublishedBtn.addEventListener('click', function(){
                    currentStatusFilter = 1;
                    currentPage = 1;
                    setFilterActiveButton();
                    loadBlogs(1);
                });
                filterDraftsBtn.addEventListener('click', function(){
                    currentStatusFilter = 0;
                    currentPage = 1;
                    setFilterActiveButton();
                    loadBlogs(1);
                });
            }
        });

        // è°ƒç”¨åç«¯æ¥å£ï¼Œè‡ªå¢å¹¶æ˜¾ç¤ºç½‘ç«™è®¿é—®è®¡æ•°
        function incrementVisitCounter(){
            fetch('/api/metrics/visit', {
                method: 'GET',
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const count = (data && data.data && typeof data.data.count !== 'undefined')
                    ? data.data.count
                    : (typeof data?.count !== 'undefined' ? data.count : null);
                if (count !== null) {
                    const el = document.getElementById('site-visit-count');
                    if (el) el.textContent = count;
                }
            })
            .catch(() => {
                const el = document.getElementById('site-visit-count');
                if (el) el.textContent = '-';
            });
        }

        function setFilterActiveButton(){
            const pubBtn = document.getElementById('filter-published');
            const draftBtn = document.getElementById('filter-drafts');
            if (!pubBtn || !draftBtn) return;
            if (currentStatusFilter === 1) {
                pubBtn.style.background = '#007bff';
                pubBtn.style.color = '#fff';
                draftBtn.style.background = '';
                draftBtn.style.color = '';
            } else {
                draftBtn.style.background = '#007bff';
                draftBtn.style.color = '#fff';
                pubBtn.style.background = '';
                pubBtn.style.color = '';
            }
        }

        // èŠ±ç“£ç‚¹å‡»ç‰¹æ•ˆ
        function initPetalEffects(){
            const canvas = document.getElementById('bg-canvas');
            const ctx = canvas.getContext('2d');
            const petals = [];

            function resize(){
                const dpr = Math.min(window.devicePixelRatio || 1, 2);
                canvas.width = Math.floor(window.innerWidth * dpr);
                canvas.height = Math.floor(window.innerHeight * dpr);
                canvas.style.width = window.innerWidth + 'px';
                canvas.style.height = window.innerHeight + 'px';
                ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            }
            window.addEventListener('resize', resize);
            resize();

            // ç”ŸæˆèŠ±ç“£å¯¹è±¡
            function spawn(x, y){
                const count = 12 + Math.floor(Math.random()*8);
                for(let i=0;i<count;i++){
                    petals.push({
                        x, y,
                        vx: (Math.random()-0.5)*2.2,
                        vy: (Math.random()-1.2)*2.6,
                        life: 60 + Math.random()*40,
                        r: 4 + Math.random()*6,
                        rot: Math.random()*Math.PI*2,
                        vr: (Math.random()-0.5)*0.2,
                        hue: 300 + Math.random()*80
                    });
                }
            }

            // ç‚¹å‡»ä¸è½»è§¦è§¦å‘
            document.addEventListener('pointerdown', e => {
                const rect = canvas.getBoundingClientRect();
                spawn(e.clientX - rect.left, e.clientY - rect.top);
            });

            function drawPetal(p){
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rot);
                const grd = ctx.createRadialGradient(0,0,0,0,0,p.r*2);
                grd.addColorStop(0, `hsla(${p.hue}, 90%, 75%, .95)`);
                grd.addColorStop(1, `hsla(${p.hue}, 90%, 60%, 0)`);
                ctx.fillStyle = grd;
                ctx.beginPath();
                ctx.moveTo(0, -p.r);
                ctx.bezierCurveTo(p.r, -p.r, p.r, p.r, 0, p.r);
                ctx.bezierCurveTo(-p.r, p.r, -p.r, -p.r, 0, -p.r);
                ctx.fill();
                ctx.restore();
            }

            function tick(){
                ctx.clearRect(0,0,canvas.width, canvas.height);
                for(let i=petals.length-1;i>=0;i--){
                    const p = petals[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.025; // é‡åŠ›
                    p.rot += p.vr;
                    p.life -= 1;
                    drawPetal(p);
                    if (p.life <= 0) petals.splice(i,1);
                }
                requestAnimationFrame(tick);
            }
            tick();
        }

        // åˆå§‹åŒ–é¡¶éƒ¨ä¸‹æ‹‰ä¸èœå•åŠ¨ä½œ
        function initHeaderMenus() {
            // ä¸‹æ‹‰å±•å¼€/æ”¶èµ·
            const dropdownButtons = document.querySelectorAll('.menu-dropdown .menu-dropdown-btn');
            dropdownButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const item = this.closest('.menu-dropdown');
                    const isOpen = item.classList.contains('open');
                    document.querySelectorAll('.menu-dropdown.open').forEach(x => x.classList.remove('open'));
                    if (!isOpen) item.classList.add('open');
                });
            });
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.menu-dropdown')) {
                    document.querySelectorAll('.menu-dropdown.open').forEach(x => x.classList.remove('open'));
                }
            });

            // åŠ¨ä½œï¼šæ–°å»ºã€ç­›é€‰ã€åˆ·æ–°ã€å›é¡¶ã€ä¸»é¢˜åˆ‡æ¢
            const newBlogLink = document.getElementById('menu-new-blog');
            if (newBlogLink) newBlogLink.addEventListener('click', function(e){
                e.preventDefault();
                const btn = document.getElementById('new-blog-btn');
                if (btn) btn.click();
            });
            const publishedLink = document.getElementById('menu-published');
            if (publishedLink) publishedLink.addEventListener('click', function(e){
                e.preventDefault();
                currentStatusFilter = 1;
                currentPage = 1;
                setFilterActiveButton();
                loadBlogs(1);
            });
            const draftsLink = document.getElementById('menu-drafts');
            if (draftsLink) draftsLink.addEventListener('click', function(e){
                e.preventDefault();
                currentStatusFilter = 0;
                currentPage = 1;
                setFilterActiveButton();
                loadBlogs(1);
            });
            const refreshLink = document.getElementById('menu-refresh');
            if (refreshLink) refreshLink.addEventListener('click', function(e){
                e.preventDefault();
                loadBlogs(currentPage || 1);
            });
            const topLink = document.getElementById('menu-top');
            if (topLink) topLink.addEventListener('click', function(e){
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            const themeLink = document.getElementById('menu-toggle-theme');
            if (themeLink) themeLink.addEventListener('click', function(e){
                e.preventDefault();
                document.body.classList.toggle('dark');
            });

            // ç•™è¨€
            const chatLink = document.getElementById('menu-chat');
            if (chatLink) chatLink.addEventListener('click', function(e){
                e.preventDefault();
                openMessageModal();
            });

            // å…³äºæˆ‘ / è”ç³»æˆ‘ å¼¹çª—
            const aboutLink = document.getElementById('menu-about');
            if (aboutLink) aboutLink.addEventListener('click', function(e){
                e.preventDefault();
                openInfoModal('å…³äºæˆ‘', `
                    <p>ä½ å¥½ï¼æˆ‘æ˜¯Hopeï¼Œä¸€ä¸ªçƒ­çˆ±ç¼–ç¨‹çš„å¹´è½»äººã€‚</p>
                    <p>æˆ‘æ˜¯ä¸€ä¸ªå–œæ¬¢ç ”ç©¶æŠ€æœ¯çš„ç¨‹åºå‘˜ï¼Œå–œæ¬¢åˆ†äº«è‡ªå·±çš„å­¦ä¹ å¿ƒå¾—å’Œç»éªŒã€‚</p>
                    <p>è¿™æ˜¯ä¸€ä¸ªç”¨ginæ¡†æ¶æ­å»ºçš„åšå®¢ç³»ç»Ÿï¼Œæ¬¢è¿è®¿é—®ã€‚</p>
                `);
            });
            const contactLink = document.getElementById('menu-contact');
            if (contactLink) contactLink.addEventListener('click', function(e){
                e.preventDefault();
                openInfoModal('è”ç³»æˆ‘', `
                    <p>æ¬¢è¿è”ç³»æˆ‘ï¼š</p>
                    <ul>
                        <li>é‚®ç®±ï¼š15166622635@163.com</li>
                        <li>å¾®ä¿¡ï¼š15166622635</li>
                    </ul>
                `);
            });
        }

        // æ‰“å¼€/å…³é—­ é€šç”¨ä¿¡æ¯æ¨¡æ€æ¡†
        function openInfoModal(title, html) {
            const titleEl = document.getElementById('info-title');
            const bodyEl = document.getElementById('info-body');
            const modal = document.getElementById('info-modal');
            if (!titleEl || !bodyEl || !modal) return;
            titleEl.textContent = title || 'ä¿¡æ¯';
            // ä½¿ç”¨ DOMPurify è¿›è¡Œå®‰å…¨æ¸²æŸ“
            if (window.DOMPurify) {
                bodyEl.innerHTML = DOMPurify.sanitize(html || '');
            } else {
                bodyEl.innerHTML = html || '';
            }
            modal.style.display = 'block';
        }

        // ç•™è¨€ï¼šæ‰“å¼€/å…³é—­/æäº¤
        function openMessageModal(){
            const modal = document.getElementById('message-modal');
            if (modal) modal.style.display = 'block';
        }
        function closeMessageModal(){
            const modal = document.getElementById('message-modal');
            if (modal) modal.style.display = 'none';
        }

        // ç»‘å®šç•™è¨€è¡¨å•æäº¤
        document.addEventListener('DOMContentLoaded', function(){
            const form = document.getElementById('message-form');
            if (form) {
                form.addEventListener('submit', function(e){
                    e.preventDefault();
                    const textarea = document.getElementById('message-text');
                    const message = (textarea && textarea.value || '').trim();
                    if (!message) {
                        alert('è¯·è¾“å…¥ç•™è¨€å†…å®¹');
                        return;
                    }
                    fetch('/api/messages', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ message })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data && data.code === 200) {
                            alert('ç•™è¨€å·²æäº¤');
                            textarea.value = '';
                            closeMessageModal();
                        } else {
                            alert(data?.msg || 'æäº¤å¤±è´¥');
                        }
                    })
                    .catch(() => {
                        alert('æäº¤è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
                    });
                });
            }
        });
        function closeInfoModal() {
            const modal = document.getElementById('info-modal');
            if (modal) modal.style.display = 'none';
        }

        // åŠ è½½åšå®¢åˆ—è¡¨
        function loadBlogs(page = 1) {
            const blogList = document.getElementById('blog-list');
            const pagination = document.getElementById('pagination');
            
            blogList.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            // å¸¦ä¸Šç­›é€‰å‚æ•°ï¼Œé¿å…è‰ç¨¿æ··å…¥å·²å‘å¸ƒ
            const params = new URLSearchParams();
            params.set('page', page);
            params.set('page_size', 10);
            if (currentStatusFilter === 0) {
                params.set('status', 0);
                params.set('own', 1);
            } else {
                params.set('status', 1);
            }

            fetch(`/api/blogs?${params.toString()}`, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    displayBlogs(data.data.blogs);
                    displayPagination(data.data.pagination);
                    currentPage = page;
                } else {
                    blogList.innerHTML = '<div class="loading">æš‚æ— åšå®¢æ–‡ç« </div>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                blogList.innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
            });
        }

        // æ˜¾ç¤ºåšå®¢åˆ—è¡¨
        function displayBlogs(blogs) {
            const blogList = document.getElementById('blog-list');
            
            if (!blogs || blogs.length === 0) {
                blogList.innerHTML = '<div class="loading">æš‚æ— åšå®¢æ–‡ç« </div>';
                return;
            }
            // å‰ç«¯å…œåº•è¿‡æ»¤ï¼Œç¡®ä¿è§†å›¾åªæ˜¾ç¤ºå½“å‰ç­›é€‰çŠ¶æ€
            const filtered = (Array.isArray(blogs) ? blogs : []).filter(blog => {
                const status = typeof blog.status === 'number' ? blog.status : 1;
                return currentStatusFilter === 1 ? status === 1 : status === 0;
            });

            if (filtered.length === 0) {
                blogList.innerHTML = '<div class="loading">æš‚æ— åšå®¢æ–‡ç« </div>';
                return;
            }

            const blogsHtml = filtered.map(blog => {
                const username = (blog.author && blog.author.username) ? blog.author.username : 'æœªçŸ¥ä½œè€…';
                const avatar = (blog.author && blog.author.avatar) ? blog.author.avatar : '';
                const created = blog.created_at ? formatDate(blog.created_at) : '';
                const views = typeof blog.view_count === 'number' ? blog.view_count : 0;
                const avatarHtml = avatar
                    ? `<img class="avatar" src="${avatar}" alt="${username}">`
                    : `<span class="avatar avatar-fallback">${username.slice(0,1).toUpperCase()}</span>`;
                return `
                <div class="blog-item" onclick="viewBlog(${blog.ID})">
                    <div class="blog-item-header">
                        ${avatarHtml}
                        <div>
                            <div class="blog-author">${username}</div>
                            <div style="font-size:12px;color:#999;">${created}</div>
                        </div>
                    </div>
                    <div class="blog-title">${blog.title}</div>
                    <div class="blog-summary">${blog.summary || 'æš‚æ— æ‘˜è¦'}</div>
                    <div class="blog-footer">
                        <div class="metrics">
                            <span class="metric">ğŸ‘ï¸ ${views}</span>
                            <span class="metric">ğŸ‘ ${blog.likes || 0}</span>
                            <span class="metric">â­ ${blog.favorites || 0}</span>
                        </div>
                        <div style="font-size:12px;color:#999;">ID: ${blog.ID}</div>
                    </div>
                </div>`;
            }).join('');
            
            blogList.innerHTML = blogsHtml;
        }

        // æ˜¾ç¤ºåˆ†é¡µ
        function displayPagination(pagination) {
            const paginationEl = document.getElementById('pagination');
            
            if (pagination.pages <= 1) {
                paginationEl.style.display = 'none';
                return;
            }
            
            paginationEl.style.display = 'flex';
            
            let paginationHtml = '';
            
            // ä¸Šä¸€é¡µæŒ‰é’®
            paginationHtml += `<button onclick="loadBlogs(${pagination.page - 1})" ${pagination.page <= 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
            
            // é¡µç æŒ‰é’®
            for (let i = 1; i <= pagination.pages; i++) {
                if (i === pagination.page) {
                    paginationHtml += `<button class="active">${i}</button>`;
                } else {
                    paginationHtml += `<button onclick="loadBlogs(${i})">${i}</button>`;
                }
            }
            
            // ä¸‹ä¸€é¡µæŒ‰é’®
            paginationHtml += `<button onclick="loadBlogs(${pagination.page + 1})" ${pagination.page >= pagination.pages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
            
            paginationEl.innerHTML = paginationHtml;
        }

        // å®‰å…¨è®¾ç½®æ–‡æœ¬å†…å®¹ï¼Œå…ƒç´ ä¸å­˜åœ¨æ—¶ä»…å‘Šè­¦ä¸æŠ›é”™
        function safeSetText(id, text) {
            const el = document.getElementById(id);
            if (!el) {
                console.warn('Missing element:', id);
                return false;
            }
            el.textContent = text ?? '';
            return true;
        }

        // æ§åˆ¶å…ƒç´ æ˜¾ç¤º/éšè—
        function setDisplay(id, show) {
            const el = document.getElementById(id);
            if (!el) {
                console.warn('Missing element:', id);
                return false;
            }
            el.style.display = show ? '' : 'none';
            return true;
        }

        // æ¸²æŸ“åšå®¢è¯¦æƒ…ï¼ˆç”¨äºå·²å‘å¸ƒæˆ–è‰ç¨¿ï¼‰
        function renderBlogDetail(blog) {
            // å¡«å……è¯¦æƒ…
            safeSetText('detail-title', 'åšå®¢è¯¦æƒ…');
            safeSetText('detail-blog-title', blog.title || '');

            const authorName = blog.author && blog.author.username ? blog.author.username : 'æœªçŸ¥ä½œè€…';
            const createdAt = blog.created_at ? formatDate(blog.created_at) : '';
            const viewCount = typeof blog.view_count === 'number' ? blog.view_count : 0;
            safeSetText('detail-meta', `ä½œè€…: ${authorName} | æ—¶é—´: ${createdAt} | é˜…è¯»: ${viewCount}`);

            const summaryText = (blog.summary || '').trim();
            const contentTextRaw = (blog.content || '').trim();
            const showSummary = summaryText.length > 0 && summaryText !== contentTextRaw;
            if (showSummary) {
                setDisplay('detail-summary', true);
                safeSetText('detail-summary', summaryText);
            } else {
                // ä¸å†…å®¹ç›¸åŒæˆ–ä¸ºç©ºåˆ™ä¸æ˜¾ç¤ºæ‘˜è¦ï¼Œé¿å…é‡å¤
                setDisplay('detail-summary', false);
                safeSetText('detail-summary', '');
            }
            // ä½¿ç”¨ marked + DOMPurify æ¸²æŸ“ Markdown å¹¶é«˜äº®ä»£ç 
            try {
                const html = marked.parse(contentTextRaw, { mangle: false, headerIds: false });
                const safe = DOMPurify.sanitize(html);
                const el = document.getElementById('detail-content');
                if (el) {
                    el.innerHTML = safe;
                    el.querySelectorAll('pre code').forEach((block) => {
                        try { hljs.highlightElement(block); } catch (e) {}
                    });
                }
            } catch (e) {
                // å…œåº•ä¸ºçº¯æ–‡æœ¬
                safeSetText('detail-content', contentTextRaw);
            }

            // æ“ä½œåŒº
            const actions = document.getElementById('detail-actions');
            if (actions) {
                actions.innerHTML = '';
                const loginUserId = currentUser && (currentUser.user_id || currentUser.id);
                const authorId = blog.author_id || (blog.author && (blog.author.ID || blog.author.id));
                const isOwner = loginUserId && authorId && Number(loginUserId) === Number(authorId);
                if (isOwner) {
                    // è‰ç¨¿ï¼šæ˜¾ç¤ºå‘å¸ƒ + åˆ é™¤
                    if (blog.status === 0) { 
                        const pubBtn = document.createElement('button');
                        pubBtn.textContent = 'å‘å¸ƒ';
                        pubBtn.style.background = '#28a745';
                        pubBtn.style.color = '#fff';
                        pubBtn.style.border = 'none';
                        pubBtn.style.padding = '8px 12px';
                        pubBtn.style.borderRadius = '4px';
                        pubBtn.style.marginRight = '8px';
                        pubBtn.onclick = function () { publishBlog(blog); };
                        actions.appendChild(pubBtn);
                    }
                    // åˆ é™¤æŒ‰é’®ï¼ˆè‰ç¨¿/å·²å‘å¸ƒå‡å¯æ˜¾ç¤ºï¼‰
                    const delBtn = document.createElement('button');
                    delBtn.textContent = 'åˆ é™¤åšå®¢';
                    delBtn.style.background = '#dc3545';
                    delBtn.style.color = '#fff';
                    delBtn.style.border = 'none';
                    delBtn.style.padding = '8px 12px';
                    delBtn.style.borderRadius = '4px';
                    delBtn.onclick = function () { deleteBlog(blog.ID || blog.id); };
                    actions.appendChild(delBtn);
                }
            }

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            openBlogDetailModal();
        }

        // æŸ¥çœ‹åšå®¢è¯¦æƒ…
        function viewBlog(id) {
            // æ‹‰å–è¯¦æƒ…
            fetch(`/api/blogs/${id}`, { credentials: 'include' })
                .then(res => res.json())
                .then(data => {
                    console.log('Debug: è¯¦æƒ…æ¥å£ code =', data?.code, 'msg =', data?.msg);
                    if (data.code !== 200) {
                        alert(data.msg || 'è·å–è¯¦æƒ…å¤±è´¥');
                        return;
                    }
                    renderBlogDetail(data.data);
                })
                .catch(err => {
                    console.error(err);
                    alert('è·å–è¯¦æƒ…è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
                });
        }

        // å‘å¸ƒåšå®¢ï¼ˆä»è‰ç¨¿åˆ°å·²å‘å¸ƒï¼Œä¸å¢åŠ é˜…è¯»é‡ï¼‰
        function publishBlog(blog) {
            const id = blog.ID || blog.id;
            if (!id) return;
            if (!confirm('ç¡®è®¤å‘å¸ƒè¯¥è‰ç¨¿å—ï¼Ÿ')) return;
            const payload = {
                title: blog.title,
                content: blog.content,
                summary: blog.summary || '',
                status: 1
            };
            fetch(`/api/blogs/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if (data.code === 200) {
                    alert('å‘å¸ƒæˆåŠŸ');
                    closeBlogDetailModal();
                    loadBlogs(1);
                } else {
                    alert(data.msg || 'å‘å¸ƒå¤±è´¥');
                }
            })
            .catch(err => {
                console.error(err);
                alert('å‘å¸ƒè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
            });
        }

        // åˆ é™¤åšå®¢
        function deleteBlog(id) {
            if (!id) return;
            if (!confirm('ç¡®è®¤åˆ é™¤è¯¥åšå®¢å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) return;
            fetch(`/api/blogs/${id}`, {
                method: 'DELETE',
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                if (data.code === 200) {
                    alert('åˆ é™¤æˆåŠŸ');
                    closeBlogDetailModal();
                    loadBlogs(1);
                } else {
                    alert(data.msg || 'åˆ é™¤å¤±è´¥');
                }
            })
            .catch(err => {
                console.error(err);
                alert('åˆ é™¤è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
            });
        }

        function openBlogDetailModal() {
            const modal = document.getElementById('blog-detail-modal');
            if (!modal) {
                console.warn('Missing element: blog-detail-modal');
                return;
            }
            modal.style.display = 'block';
        }

        function closeBlogDetailModal() {
            const modal = document.getElementById('blog-detail-modal');
            if (!modal) {
                console.warn('Missing element: blog-detail-modal');
                return;
            }
            modal.style.display = 'none';
        }

        // æ‰“å¼€åšå®¢æ¨¡æ€æ¡†
        function openBlogModal() {
            document.getElementById('blog-modal').style.display = 'block';
            document.getElementById('modal-title').textContent = 'æ–°å»ºåšå®¢';
            document.getElementById('blog-form').reset();
        }

        // å…³é—­åšå®¢æ¨¡æ€æ¡†
        function closeBlogModal() {
            document.getElementById('blog-modal').style.display = 'none';
        }

        // å¤„ç†åšå®¢è¡¨å•æäº¤
        function handleBlogSubmit(e) {
            e.preventDefault(); 
            if (isSavingDraft) {
                console.log('Debug: æ­£åœ¨ä¿å­˜è‰ç¨¿ï¼Œå¿½ç•¥è¡¨å•æäº¤');
                return;
            }
            
            // é¦–å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•åå†åˆ›å»ºåšå®¢');
                return;
            }
            
            const formData = new FormData(e.target);
            const blogData = {
                title: formData.get('title'),
                summary: formData.get('summary'),
                content: formData.get('content'),
                status: formData.get('status') ? 1 : 0
            };
            
            console.log('Debug: å‡†å¤‡åˆ›å»ºåšå®¢ï¼Œå½“å‰ç”¨æˆ·:', currentUser);
            console.log('Debug: åšå®¢æ•°æ®:', blogData);
            
            fetch('/api/blogs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify(blogData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    alert('åšå®¢åˆ›å»ºæˆåŠŸï¼');
                    closeBlogModal();
                    loadBlogs(1); // é‡æ–°åŠ è½½ç¬¬ä¸€é¡µ
                } else {
                    alert(data.msg || 'åˆ›å»ºå¤±è´¥');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('åˆ›å»ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
            });
        }

        // å­˜ä¸ºè‰ç¨¿ï¼ˆstatus å¼ºåˆ¶ä¸º 0ï¼‰
        function saveDraft() {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•åå†ä¿å­˜è‰ç¨¿');
                return;
            }
            isSavingDraft = true;
            const form = document.getElementById('blog-form');
            const formData = new FormData(form);
            const blogData = {
                title: formData.get('title'),
                summary: formData.get('summary'),
                content: formData.get('content'),
                status: 0
            };
            console.log('Debug: ä¿å­˜è‰ç¨¿ï¼Œæ•°æ®:', blogData);
            fetch('/api/blogs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify(blogData)
            })
            .then(res => res.json())
            .then(data => {
                console.log('Debug: ä¿å­˜è‰ç¨¿è¿”å›:', data);
                if (data.code === 200) {
                    console.log('Debug: æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ status =', data?.data?.status);
                    alert('è‰ç¨¿å·²ä¿å­˜');
                    closeBlogModal();
                    // åˆ‡æ¢åˆ°è‰ç¨¿è§†å›¾å¹¶åˆ·æ–°
                    currentStatusFilter = 0;
                    setFilterActiveButton();
                    loadBlogs(1);
                } else {
                    alert(data.msg || 'ä¿å­˜è‰ç¨¿å¤±è´¥');
                }
            })
            .catch(err => {
                console.error(err);
                alert('ä¿å­˜è‰ç¨¿è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
            })
            .finally(() => {
                isSavingDraft = false;
            });
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html> 